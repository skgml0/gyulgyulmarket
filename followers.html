<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>귤귤마켓 - 프로필 리스트</title>
<link rel="stylesheet" href="src/style/reset.css">
<link rel="stylesheet" href="src/style/style_module.css">
<link rel="stylesheet" href="src/style/follow_list.css">
<link rel="stylesheet" href="src/style/common.css">
</head>
<body>
<div class="nav-top">
    <a href="#" class="nav-top__btn--goback">
        <img src="src/images/icon/icon-arrow-left.png" alt="뒤로가기">
    </a>
    <span class="nav-txt">Followers</span>
</div>

<ul class="profile-list-container">

</ul>

<nav class="nav-tab-menu">
<ul class="nav-tab-menu__list">
    <li class="nav-tab-menu__item">
        <a href="#" class="nav-tab-menu__wrapper nav-tab-menu__home nav-tab-menu__home--active">
            <p class="nav-tab-menu__txt nav-tab-menu__txt--active">홈</p>
        </a>
    </li>
    <li class="nav-tab-menu__item">
        <a href="#" class="nav-tab-menu__wrapper nav-tab-menu__chat">
            <p class="nav-tab-menu__txt">채팅</p>
        </a>
    </li>
    <li class="nav-tab-menu__item">
        <a href="#" class="nav-tab-menu__wrapper nav-tab-menu__post">
            <p class="nav-tab-menu__txt">게시물 작성</p>
        </a>
    </li>
    <li class="nav-tab-menu__item">
        <a href="#" class="nav-tab-menu__wrapper nav-tab-menu__profile">
            <p class="nav-tab-menu__txt">프로필</p>
        </a>
    </li>
</ul>
</nav>
<script>
    const urlQuery = window.location.search.split('?')[1];

    console.log(urlQuery)

    console.log(document.cookie)
    let JWT_TOKEN =document.cookie.split(" ").filter((key)=> {
        if(key.match('gyulgyul-token') !==null) return key
    }).join('').replace('gyulgyul-token=','');

    console.log(JWT_TOKEN)

    async function followersData() {
        const res = await fetch(`http://146.56.183.55:5050/profile/${urlQuery}/follower`,{
            method: "get",
            headers: {
                "Content-Type": "application/json",
                "Authorization" : `Bearer ${JWT_TOKEN}`
            },
        });
        const json = await res.json()
        console.log(json)

        const followerList = document.querySelector('.profile-list-container')
        followerList.innerHTML = json.map((item)=>{
            return `
                <li class="item-user-follow" data-accountname="${item.accountname}">
                    <div class="item-user-follow__wrapper">
                        <img src="${item.image}" alt="프로필이미지" class="item-user-follow__img-user">
                        <ul class="item-user-follow__list">
                            <li class="item-user-follow__username">${item.accountname}</li>
                            <li class="item-user-follow__userid">${item.intro}</li>
                        </ul>
                    </div>
                    <button type="button" class="s-btn">팔로우</button>
                </li>               
            `
        })

        console.log(followerList.children);
        [...followerList.children].forEach((item)=>{
            item.addEventListener('click',({currentTarget}) => {
                // console.log(currentTarget.dataset.accountname)
                location.href = `${window.location.origin}/profile.html?${currentTarget.dataset.accountname}`;
                // location.href = `http://127.0.0.1:5500/followers.html?${currentTarget.dataset.accountname}`;
            })
        })
    }
    followersData()

</script>
</body>
</html>
