<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>귤귤마켓 - 프로필 리스트</title>
    <link rel="stylesheet" href="src/style/reset.css">
    <link rel="stylesheet" href="src/style/style_module.css">
    <link rel="stylesheet" href="src/style/follow_list.css">
    <link rel="stylesheet" href="src/style/common.css">
</head>

<body>
    <div class="nav-top">
        <a href="#" class="nav-top__btn--goback">
            <img src="src/images/icon/icon-arrow-left.png" alt="뒤로가기">
        </a>
        <p class="nav-txt">Followers</span>
    </div>

    <div class="profile-list-container">
        <li class="item-user-follow">
            <div class="item-user-follow__wrapper">
                <img src="src/images/profile-img/Ellipse 1.png" alt="프로필이미지" class="item-user-follow__img-user">
                <ul class="item-user-follow__list">
                    <li class="item-user-follow__username">애월읍 한라봉 최고 맛집</li>
                    <li class="item-user-follow__userid">정성을 다해 농사짓는 한라봉</li>
                </ul>
            </div>
            <button type="button" class="s-btn">팔로우</button>
        </li>

        <li class="item-user-follow">
            <div class="item-user-follow__wrapper">
                <img src="src/images/profile-img/Ellipse 2.png" alt="프로필이미지" class="item-user-follow__img-user">
                <ul class="item-user-follow__list">
                    <li class="item-user-follow__username">감귤의 품격 - 애월읍</li>
                    <li class="item-user-follow__userid">제주 노지귤, 하우스 한라봉 판매합니다. </li>
                </ul>
            </div>
            <button type="button" class="s-btn">팔로우</button>
        </li>

        <li class="item-user-follow">
            <div class="item-user-follow__wrapper">
                <img src="src/images/profile-img/Ellipse 3.png" alt="프로필이미지" class="item-user-follow__img-user">
                <ul class="item-user-follow__list">
                    <li class="item-user-follow__username">한라봉의 신</li>
                    <li class="item-user-follow__userid">30년 노하우로 정성스럽게 농사지은 노지...</li>
                </ul>
            </div>
            <button type="button" class="s-btn s-btn--active">취소</button>
        </li>

        <li class="item-user-follow">
            <div class="item-user-follow__wrapper">
                <img src="src/images/profile-img/Ellipse 4.png" alt="프로필이미지" class="item-user-follow__img-user">
                <ul class="item-user-follow__list">
                    <li class="item-user-follow__username">나 감귤 좋아하네</li>
                    <li class="item-user-follow__userid">감귤농장 컬렉터 i love mandarin</li>
                </ul>
            </div>
            <button type="button" class="s-btn s-btn--active">취소</button>
        </li>

        <li class="item-user-follow">
            <div class="item-user-follow__wrapper">
                <img src="src/images/profile-img/Ellipse 5.png" alt="프로필이미지" class="item-user-follow__img-user">
                <ul class="item-user-follow__list">
                    <li class="item-user-follow__username">애월읍 한라봉 최고 맛집</li>
                    <li class="item-user-follow__userid"></li>
                </ul>
            </div>
            <button type="button" class="s-btn">팔로우</button>
        </li>

        <li class="item-user-follow">
            <div class="item-user-follow__wrapper">
                <img src="src/images/profile-img/Ellipse 6.png" alt="프로필이미지" class="item-user-follow__img-user">
                <ul class="item-user-follow__list">
                    <li class="item-user-follow__username">제주 키위, 한라봉 판매</li>
                    <li class="item-user-follow__userid">키위, 한라봉</li>
                </ul>
            </div>
            <button type="button" class="s-btn s-btn--active">취소</button>
        </li>

        <li class="item-user-follow">
            <div class="item-user-follow__wrapper">
                <img src="src/images/profile-img/Ellipse 7.png" alt="프로필이미지" class="item-user-follow__img-user">
                <ul class="item-user-follow__list">
                    <li class="item-user-follow__username">싱싱한 제주 한라봉</li>
                    <li class="item-user-follow__userid"></li>
                </ul>
            </div>
            <button type="button" class="s-btn">팔로우</button>
        </li>
    </div>

    <nav class="nav-tab-menu">
        <ul class="nav-tab-menu__list">
            <li class="nav-tab-menu__item">
                <a href="#" class="nav-tab-menu__wrapper nav-tab-menu__home nav-tab-menu__home--active">
                    <p class="nav-tab-menu__txt nav-tab-menu__txt--active">홈</p>
                </a>
            </li>
            <li class="nav-tab-menu__item">
                <a href="#" class="nav-tab-menu__wrapper nav-tab-menu__chat">
                    <p class="nav-tab-menu__txt">채팅</p>
                </a>
            </li>
            <li class="nav-tab-menu__item">
                <a href="#" class="nav-tab-menu__wrapper nav-tab-menu__post">
                    <p class="nav-tab-menu__txt">게시물 작성</p>
                </a>
            </li>
            <li class="nav-tab-menu__item">
                <a href="#" class="nav-tab-menu__wrapper nav-tab-menu__profile">
                    <p class="nav-tab-menu__txt">프로필</p>
                </a>
            </li>
        </ul>
    </nav>
    <script>
        const urlQuery = window.location.search.split('?')[1];

        console.log(urlQuery)

        console.log(document.cookie)
        let JWT_TOKEN = document.cookie.split(" ").filter((key) => {
            if (key.match('gyulgyul-token') !== null) return key
        }).join('').replace('gyulgyul-token=', '');

        console.log(JWT_TOKEN)

        async function followersData() {
            const res = await fetch(`http://146.56.183.55:5050/profile/${urlQuery}/following`, {
                method: "get",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `Bearer ${JWT_TOKEN}`
                },
            });
            const json = await res.json()
            console.log(json)

            const followingList = document.querySelector('.profile-list-container')
            followingList.innerHTML = json.map((item) => {
                return `
                <li class="item-user-follow" data-accountname="${item.accountname}">
                    <div class="item-user-follow__wrapper">
                        <img src="${item.image}" alt="프로필이미지" class="item-user-follow__img-user">
                        <ul class="item-user-follow__list">
                            <li class="item-user-follow__username">${item.accountname}</li>
                            <li class="item-user-follow__userid">${item.intro}</li>
                        </ul>
                    </div>
                    <button type="button" class="s-btn">팔로우</button>
                </li>               
            `
            })
            json.map((item)=> {
                if(!!item.intro){
                    
                }
            })

            console.log(followingList.children);
            [...followingList.children].forEach((item) => {
                item.addEventListener('click', ({ currentTarget }) => {
                    // console.log(currentTarget.dataset.accountname)
                    location.href = `${window.location.origin}/profile.html?${currentTarget.dataset.accountname}`;
                    // location.href = `http://127.0.0.1:5500/followers.html?${currentTarget.dataset.accountname}`;
                })
                //로컬스토리지에 스택을 쌓아야했어요
                // 그ㅡ forEach마다 클릭이벤트 주신거 확인
            })
        }
        followersData()
    </script>
</body>

</html>